@startuml
title Diagrama de Flujo Completo: Paradigma de Programación Cálculo PI

start
:Inicio del sistema;
note right
Sistema imprime:
"Sistema Cálculo PI iniciado"
end note

:Crear proceso coordinador;
:Crear 3 procesos trabajadores;
:Crear canales privados;
note right
Sistema imprime:
"Canales creados:"
- canal_datos
- canal_gradientes
- canal_parametros
- canal_control
end note

:Coordinador: Inicializar θ;
note right
Imprime:
"Parámetros iniciales"
"θ = [0.5, 0.3]"
end note

:Enviar datos por canal_datos;
note right
Imprime:
"Enviando particiones"
"a los 3 trabajadores"
end note

fork
    :Trabajador 1: Esperar en canal_datos;
    :Trabajador 1: Recibir datos;
    note right
    Imprime:
    "Trabajador 1: Datos OK"
    end note
    :Trabajador 1: Esperar en canal_parametros;
    :Trabajador 1: Recibir θ;
    note right
    Imprime:
    "Trabajador 1: θ recibido"
    end note
    :Trabajador 1: Calcular gradiente;
    note right
    Imprime:
    "Trabajador 1: Calculando"
    "∇f₁ = [0.2, 0.1]"
    end note
    :Trabajador 1: Enviar por canal_gradientes;
    note right
    Imprime:
    "Trabajador 1: Enviado"
    end note
fork again
    :Trabajador 2: Esperar en canal_datos;
    :Trabajador 2: Recibir datos;
    note right
    Imprime:
    "Trabajador 2: Datos OK"
    end note
    :Trabajador 2: Esperar en canal_parametros;
    :Trabajador 2: Recibir θ;
    note right
    Imprime:
    "Trabajador 2: θ recibido"
    end note
    :Trabajador 2: Calcular gradiente;
    note right
    Imprime:
    "Trabajador 2: Calculando"
    "∇f₂ = [0.15, 0.12]"
    end note
    :Trabajador 2: Enviar por canal_gradientes;
    note right
    Imprime:
    "Trabajador 2: Enviado"
    end note
fork again
    :Trabajador 3: Esperar en canal_datos;
    :Trabajador 3: Recibir datos;
    note right
    Imprime:
    "Trabajador 3: Datos OK"
    end note
    :Trabajador 3: Esperar en canal_parametros;
    :Trabajador 3: Recibir θ;
    note right
    Imprime:
    "Trabajador 3: θ recibido"
    end note
    :Trabajador 3: Calcular gradiente;
    note right
    Imprime:
    "Trabajador 3: Calculando"
    "∇f₃ = [0.25, 0.08]"
    end note
    :Trabajador 3: Enviar por canal_gradientes;
    note right
    Imprime:
    "Trabajador 3: Enviado"
    end note
end fork

:Coordinador: Esperar gradientes;
note right
Imprime:
"Esperando 3 gradientes..."
end note

:Coordinador: Recibir ∇f₁;
:Coordinador: Recibir ∇f₂;
:Coordinador: Recibir ∇f₃;
note right
Imprime:
"Los 3 gradientes recibidos"
end note

:Coordinador: Calcular promedio;
note right
∇f_prom = (∇f₁+∇f₂+∇f₃)/3
Imprime: "[0.20, 0.10]"
end note

:Coordinador: Actualizar parámetros;
note right
θ_nuevo = θ - α × ∇f_prom
Imprime: "θ = [0.48, 0.29]"
end note

:Coordinador: Verificar convergencia;

if (¿Convergió?) then (Sí)
    :Enviar STOP por canal_control;
    note right
    Imprime:
    "Convergencia alcanzada"
    "Enviando STOP"
    end note

    :Trabajadores reciben STOP;
    note right
    Todos imprimen:
    "Finalizando..."
    end note

    :Mostrar parámetros finales;
    note right
    Imprime:
    "θ final = [0.48, 0.29]"
    "Sistema finalizado"
    end note

else (No)
    :Enviar CONTINUAR por canal_control;
    note right
    Imprime:
    "Enviando CONTINUAR"
    end note

    :Enviar θ_nuevo por canal_parametros;
    note right
    Imprime:
    "Broadcast de nuevos θ"
    end note

    :Volver a calcular gradientes;
    note right
    Regresa al ciclo
    de iteración
    end note
endif

stop
@enduml